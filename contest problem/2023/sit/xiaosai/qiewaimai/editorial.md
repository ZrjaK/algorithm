# 解法一：

观察发现如果 $(l, r)$ 是规律的，那么 $(l, r-1)$ 也是规律的。那么对于固定的左端点 $l$，可以二分右端点 $r$ ，$r-l+1$ 即左端点 $l$ 对答案的贡献。

使用字符串哈希的思想可以在 $O(1)$ 内判断两段数组是否相等。

时间复杂度 $O(n\log n)$ 。

# 解法二：

每个左端点 $l$ 的贡献为 $a[l,n]$ 与 $a[1,n]$ 的最长公共前缀。

使用 [Z 函数（扩展 KMP）](https://oi-wiki.org/string/z-func/)即可在线性时间内求解 。

时间复杂度 $O(n)$ 。