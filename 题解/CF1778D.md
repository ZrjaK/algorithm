不难发现答案只和 $a$ 与 $b$ 中不同位置的数量 $diff$ 有关

设 $f(i)$ 有 $i$ 个位置不同时，变成全部相同需要的期望次数，答案为 $f(diff)$，对所有 $i \in [0...n]$ 有

$f(i) = 1 + \frac{i}{n}f(i-1) + \frac{n-i}{n}f(i+1)$

对下面两个式子使用代入法

$f(n-1) = 1 + \frac{n-1}{n}f(n-2)+\frac{1}{n}f(n)$

$f(n) = 1 + f(n-1)$

则有 $f(n-1) = f(n-2) + \frac{n+1}{n-1}$

求出 $f(n-1)$ 后，同理 $f(n-2) = f(n-3) + \frac{2\cdot\frac{n+1}{n-1} + n}{n-2}$

可以看出 $f(i)$ 常数部分只和 $i$ 有关，可以整理成 

$f(i) = f(i-1) + g(i)$，$f(0) = 0$

$g(i) = \frac{g(i+1)\cdot (n-i)+n}{i}$，$g(n) = 1$

倒序算出 $g(i)$ 后，$f(i)$ 也都能算出来了